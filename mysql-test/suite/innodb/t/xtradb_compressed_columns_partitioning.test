--source include/have_innodb.inc
--source include/have_partition.inc

#
# Bug lp:1653104 "Compression dictionaries are not being used in partitioned tables"
#
CREATE COMPRESSION_DICTIONARY numbers ('one' 'two' 'three');

# No subpartitions, partition names are specified explicitly
CREATE TABLE t1 (
  id BIGINT UNSIGNED NOT NULL,
  a VARCHAR(250) COLUMN_FORMAT COMPRESSED WITH COMPRESSION_DICTIONARY numbers DEFAULT NULL
) ENGINE=InnoDB
PARTITION BY RANGE (id) (
 PARTITION p1 VALUES LESS THAN (100) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN MAXVALUE ENGINE = InnoDB
);
SHOW CREATE TABLE t1;
DROP TABLE t1;

# No subpartitions, partition names are auto-generated
CREATE TABLE t1 (
  id BIGINT UNSIGNED NOT NULL,
  a VARCHAR(250) COLUMN_FORMAT COMPRESSED WITH COMPRESSION_DICTIONARY numbers DEFAULT NULL
) ENGINE=InnoDB
PARTITION BY HASH (id)
PARTITIONS 2;
SHOW CREATE TABLE t1;
DROP TABLE t1;

# Subpartitions, subpartition names are specified explicitly
CREATE TABLE t1 (
  id BIGINT UNSIGNED NOT NULL,
  a VARCHAR(250) COLUMN_FORMAT COMPRESSED WITH COMPRESSION_DICTIONARY numbers DEFAULT NULL
) ENGINE=InnoDB
PARTITION BY RANGE (id)
SUBPARTITION BY HASH(id)
SUBPARTITIONS 2 (
  PARTITION p0 VALUES LESS THAN (1024) (
    SUBPARTITION s0 ENGINE=InnoDB,
    SUBPARTITION s1 ENGINE=InnoDB
  ),
  PARTITION p1 VALUES LESS THAN MAXVALUE (
    SUBPARTITION s2 ENGINE=InnoDB,
    SUBPARTITION s3 ENGINE=InnoDB
  )
);
SHOW CREATE TABLE t1;
DROP TABLE t1;

# Subpartitions, subpartition names are auto-generated
CREATE TABLE t1 (
  id BIGINT UNSIGNED NOT NULL,
  a VARCHAR(250) COLUMN_FORMAT COMPRESSED WITH COMPRESSION_DICTIONARY numbers DEFAULT NULL
) ENGINE=InnoDB
PARTITION BY RANGE (id)
SUBPARTITION BY HASH(id)
SUBPARTITIONS 2 (
  PARTITION p0 VALUES LESS THAN (1024) ENGINE = InnoDB,
  PARTITION p1 VALUES LESS THAN MAXVALUE ENGINE = InnoDB
);
SHOW CREATE TABLE t1;
DROP TABLE t1;

DROP COMPRESSION_DICTIONARY numbers;
